<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savings Calculator - PesaGuru</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Chart.js for graphs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <!-- jsPDF for report generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-color: #1e88e5;
            --primary-dark: #1565c0;
            --accent-color: #43a047;
            --warning-color: #ff9800;
            --error-color: #e53935;
            --text-color: #333333;
            --text-light: #757575;
            --background-color: #f5f5f5;
            --card-color: #ffffff;
            --border-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --chart-color-1: rgba(30, 136, 229, 0.8);
            --chart-color-2: rgba(67, 160, 71, 0.8);
            --chart-color-3: rgba(255, 152, 0, 0.8);
            --success-bg: #e8f5e9;
            --border-radius: 8px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dark-mode {
            --primary-color: #2196f3;
            --primary-dark: #1976d2;
            --accent-color: #4caf50;
            --warning-color: #ffc107;
            --error-color: #f44336;
            --text-color: #f5f5f5;
            --text-light: #bdbdbd;
            --background-color: #121212;
            --card-color: #1e1e1e;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --chart-color-1: rgba(33, 150, 243, 0.8);
            --chart-color-2: rgba(76, 175, 80, 0.8);
            --chart-color-3: rgba(255, 193, 7, 0.8);
            --success-bg: #1b5e20;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            width: 100%;
            min-height: 100vh;
        }

        /* Main Content */
        .main-content {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .header-title h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            color: var(--text-light);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 0.6rem 1.2rem;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 0.95rem;
            text-decoration: none;
            justify-content: center;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-outline {
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--text-color);
        }

        .btn-outline:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon i {
            margin-right: 0;
        }

        /* Cards */
        .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px var(--shadow-color);
            margin-bottom: 1.5rem;
            transition: background-color 0.3s;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.3rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Grid Layout */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--card-color);
            color: var(--text-color);
            transition: border-color 0.2s;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-help {
            display: block;
            margin-top: 0.5rem;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        /* Slider Input */
        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .slider-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .slider {
            width: 100%;
            height: 5px;
            background-color: var(--border-color);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            border-radius: 5px;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--primary-color);
            cursor: pointer;
        }

        /* Results Display */
        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .result-label {
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .result-card {
            text-align: center;
            padding: 1.5rem;
            transition: transform 0.2s;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        /* Charts */
        .chart-container {
            height: 300px;
            position: relative;
            margin-bottom: 1.5rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
            font-weight: 500;
            position: relative;
        }

        .tab.active {
            color: var(--primary-color);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary-color);
        }

        /* Goal Setting Section */
        .goal-item {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .goal-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .goal-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(var(--primary-color-rgb), 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }

        .goal-icon i {
            color: var(--primary-color);
        }

        .goal-progress {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
            width: 100%;
        }

        .goal-progress-bar {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--card-color);
            color: var(--text-color);
            text-align: center;
            border-radius: var(--border-radius);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 8px var(--shadow-color);
            font-size: 0.85rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Responsive Styles */
        @media screen and (max-width: 1200px) {
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media screen and (max-width: 992px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media screen and (max-width: 576px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-actions {
                margin-top: 1rem;
                width: 100%;
                justify-content: space-between;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .card-header .actions {
                margin-top: 1rem;
            }
        }

        /* Print styles */
        @media print {
            .main-content {
                width: 100%;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: 1px solid var(--border-color);
            }

            .btn {
                display: none;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Currency Display */
        .currency-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Interactive toggle elements */
        .text-info {
            color: var(--primary-color);
        }

        .text-success {
            color: var(--accent-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .badge-success {
            background-color: var(--success-bg);
            color: var(--accent-color);
        }

        .badge-info {
            background-color: rgba(var(--primary-color-rgb), 0.1);
            color: var(--primary-color);
        }

        /* Dark mode styles */
        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-color);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 100;
        }
        
        .display-flex {
            display: flex;
        }
        
        .align-center {
            align-items: center;
        }
        
        .gap-sm {
            gap: 0.5rem;
        }
        
        .gap-md {
            gap: 1rem;
        }
        
        .text-left {
            text-align: left;
        }
        
        .text-right {
            text-align: right;
        }
        
        .padding-standard {
            padding: 0.75rem;
        }
        
        .border-bottom {
            border-bottom: 1px solid var(--border-color);
        }
        
        .strategy-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        
        .strategy-table th,
        .strategy-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .strategy-table th {
            text-align: left;
        }
        
        .strategy-table td.number-cell {
            text-align: right;
        }
        
        .width-100 {
            width: 100%;
        }
        
        .margin-top {
            margin-top: 1.5rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px var(--shadow-color);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .modal-close {
            border: none;
            background: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Saved plan list */
        .saved-plan-list {
            margin-bottom: 1.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .saved-plan-item {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .saved-plan-item:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .saved-plan-info {
            flex: 1;
        }

        .saved-plan-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .saved-plan-date {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .saved-plan-actions {
            display: flex;
            gap: 0.5rem;
        }

        .saved-plan-actions button {
            padding: 0.4rem;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-light);
            border-radius: 4px;
            transition: background-color 0.2s, color 0.2s;
        }

        .saved-plan-actions button:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-color);
        }

        /* Plan name input */
        .plan-name-input {
            margin-bottom: 1rem;
        }

        /* No saved plans message */
        .no-saved-plans {
            text-align: center;
            padding: 2rem 1rem;
            color: var(--text-light);
            font-style: italic;
        }

        #resultsContainer {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        /* Fade-in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .chart-container {
            height: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-title">
                    <h1><i class="fas fa-chart-line"></i> PesaGuru Savings Calculator</h1>
                    <div class="header-subtitle">Plan, track, and optimize your savings goals</div>
                </div>
                
                <div class="header-actions">
                    <button id="refreshButton" class="btn btn-outline">
                        <i class="fas fa-sync-alt"></i> Reset
                    </button>
                    <button id="saveCalculationBtn" class="btn btn-outline">
                        <i class="fas fa-save"></i> Save Plan
                    </button>
                    <button id="savedPlansButton" class="btn btn-outline">
                        <i class="fas fa-bookmark"></i> Saved Plans
                    </button>
                    <button id="downloadReportBtn" class="btn btn-primary">
                        <i class="fas fa-file-download"></i> Download Report
                    </button>
                </div>
            </div>
            
            <!-- Main Calculator -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-calculator"></i> Savings Growth Calculator</h2>
                    <div class="currency-display">
                        <label for="currencySelector">Currency:</label>
                        <select id="currencySelector" aria-label="Select currency">
                            <option value="KES">KES</option>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                        </select>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="grid grid-2">
                        <!-- Inputs Section -->
                        <div>
                            <form id="savingsForm">
                                <div class="form-group">
                                    <label for="initialAmount" class="form-label">
                                        Initial Savings Amount
                                        <i class="fas fa-question-circle tooltip">
                                            <span class="tooltip-text">The amount you already have saved up to start with.</span>
                                        </i>
                                    </label>
                                    <input type="number" id="initialAmount" class="form-control" value="10000" min="0" aria-describedby="initialAmountHelp">
                                    <span id="initialAmountHelp" class="form-help">Enter your starting savings amount</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="contributionAmount" class="form-label">
                                        Regular Contribution
                                        <i class="fas fa-question-circle tooltip">
                                            <span class="tooltip-text">How much will you add to your savings regularly?</span>
                                        </i>
                                    </label>
                                    <input type="number" id="contributionAmount" class="form-control" value="5000" min="0" aria-describedby="contributionHelp">
                                    <span id="contributionHelp" class="form-help">Enter how much you'll contribute regularly</span>
                                </div>
                                
                                <div class="form-group">
                                    <fieldset>
                                        <legend class="form-label">Contribution Frequency</legend>
                                        <div class="display-flex gap-md">
                                            <label class="display-flex align-center gap-sm">
                                                <input type="radio" name="contributionFrequency" value="monthly" checked>
                                                Monthly
                                            </label>
                                            <label class="display-flex align-center gap-sm">
                                                <input type="radio" name="contributionFrequency" value="quarterly">
                                                Quarterly
                                            </label>
                                            <label class="display-flex align-center gap-sm">
                                                <input type="radio" name="contributionFrequency" value="annually">
                                                Annually
                                            </label>
                                        </div>
                                    </fieldset>
                                </div>
                                
                                <div class="form-group">
                                    <label for="interestRateSlider" class="form-label">
                                        Annual Interest Rate (%)
                                        <i class="fas fa-question-circle tooltip">
                                            <span class="tooltip-text">The annual percentage rate your savings will earn.</span>
                                        </i>
                                    </label>
                                    <div class="slider-container">
                                        <input type="range" id="interestRateSlider" class="slider" min="0" max="20" step="0.1" value="5" aria-describedby="interestRateValue">
                                        <div class="slider-info">
                                            <span>0%</span>
                                            <span id="interestRateValue">5%</span>
                                            <span>20%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="durationSlider" class="form-label">
                                        Savings Duration (Years)
                                        <i class="fas fa-question-circle tooltip">
                                            <span class="tooltip-text">How long will you be saving for?</span>
                                        </i>
                                    </label>
                                    <div class="slider-container">
                                        <input type="range" id="durationSlider" class="slider" min="1" max="40" step="1" value="10" aria-describedby="durationValue">
                                        <div class="slider-info">
                                            <span>1 year</span>
                                            <span id="durationValue">10 years</span>
                                            <span>40 years</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="compoundingFrequency" class="form-label">
                                        Compounding Frequency
                                        <i class="fas fa-question-circle tooltip">
                                            <span class="tooltip-text">How often the interest is calculated and added to your balance.</span>
                                        </i>
                                    </label>
                                    <select id="compoundingFrequency" class="form-control" aria-describedby="compoundingHelp">
                                        <option value="daily">Daily</option>
                                        <option value="monthly" selected>Monthly</option>
                                        <option value="quarterly">Quarterly</option>
                                        <option value="annually">Annually</option>
                                    </select>
                                    <span id="compoundingHelp" class="form-help">Select how often interest is calculated</span>
                                </div>
                                
                                <button type="submit" class="btn btn-primary width-100 margin-top">
                                    <i class="fas fa-calculator"></i> Calculate
                                </button>
                            </form>
                        </div>
                        
                        <!-- Results Section -->
                        <div>
                            <div id="resultsContainer" class="animate-fade-in"></div>
                                <div class="grid grid-2">
                                    <div class="result-card card">
                                        <div class="result-label">Future Value</div>
                                        <div id="futureValue" class="result-value">0</div>
                                        <div class="badge badge-success">Your Estimated Savings</div>
                                    </div>
                                    
                                    <div class="result-card card">
                                        <div class="result-label">Total Contributions</div>
                                        <div id="totalContributions" class="result-value">0</div>
                                        <div>Principal Amount</div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-2 margin-top">
                                    <div class="result-card card">
                                        <div class="result-label">Interest Earned</div>
                                        <div id="interestEarned" class="result-value text-success">0</div>
                                        <div>Compound Growth</div>
                                    </div>
                                    
                                    <div class="result-card card">
                                        <div class="result-label">Monthly Income*</div>
                                        <div id="monthlyIncome" class="result-value text-info">0</div>
                                        <div class="form-help">*Estimated at 4% annual withdrawal</div>
                                    </div>
                                </div>
                                
                                <div class="chart-container margin-top">
                                    <canvas id="savingsGrowthChart"></canvas>
                                </div>
                                
                                <div class="card margin-top">
                                    <div class="card-header">
                                        <h2>Savings Breakdown</h2>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="savingsBreakdownChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Custom Reports & Forecasting -->
            <div class="card">
                <div class="card-header">
                    <h2><i class="fas fa-chart-bar"></i> Savings Strategy Comparison</h2>
                </div>
                
                <div class="card-body">
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label">Strategy 1: Regular Fixed Contributions</label>
                            <div class="badge badge-success">Current Strategy</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="increasingContributions" class="form-label">Strategy 2: Increasing Contributions</label>
                            <select class="form-control" id="increasingContributions" aria-label="Select annual contribution increase percentage">
                                <option value="5">5% annual increase</option>
                                <option value="10">10% annual increase</option>
                                <option value="15">15% annual increase</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="lumpSumAmount" class="form-label">Strategy 3: Lump Sum + Smaller Contributions</label>
                            <input type="number" class="form-control" id="lumpSumAmount" placeholder="Lump sum amount" value="100000" aria-describedby="lumpSumHelp">
                            <span id="lumpSumHelp" class="form-help">Enter initial lump sum amount</span>
                        </div>
                    </div>
                    
                    <div class="chart-container margin-top">
                        <canvas id="strategyComparisonChart"></canvas>
                    </div>
                    
                    <table class="strategy-table">
                        <thead>
                            <tr>
                                <th class="text-left padding-standard border-bottom">Strategy</th>
                                <th class="text-right padding-standard border-bottom">Final Amount</th>
                                <th class="text-right padding-standard border-bottom">Total Contribution</th>
                                <th class="text-right padding-standard border-bottom">Interest Earned</th>
                                <th class="text-right padding-standard border-bottom">Efficiency Ratio</th>
                            </tr>
                        </thead>
                        <tbody id="strategyComparisonTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Dark Mode Toggle -->
    <div class="mode-toggle">
        <span>Dark Mode</span>
        <label class="toggle-switch">
            <input type="checkbox" id="darkModeToggle" aria-label="Toggle dark mode">
            <span class="toggle-slider"></span>
        </label>
    </div>
    
    <!-- Save Plan Modal -->
    <div class="modal-overlay" id="savePlanModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Save Calculation Plan</h3>
                <button class="modal-close" id="savePlanCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group plan-name-input">
                    <label for="planName" class="form-label">Plan Name</label>
                    <input type="text" id="planName" class="form-control" placeholder="e.g. Retirement Plan 2025">
                </div>
                <div class="form-group">
                    <label class="form-label">Plan Details</label>
                    <div id="planDetails" class="card-body"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelSavePlanBtn">Cancel</button>
                <button class="btn btn-primary" id="confirmSavePlanBtn">Save Plan</button>
            </div>
        </div>
    </div>
    
    <!-- Saved Plans Modal -->
    <div class="modal-overlay" id="savedPlansModal">
        <div class="modal">
            <div class="modal-header">
                <h3>My Saved Plans</h3>
                <button class="modal-close" id="savedPlansCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="savedPlansList" class="saved-plan-list">
                    <!-- Saved plans will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="closeSavedPlansBtn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const initialAmountInput = document.getElementById('initialAmount');
        const contributionAmountInput = document.getElementById('contributionAmount');
        const interestRateSlider = document.getElementById('interestRateSlider');
        const interestRateValue = document.getElementById('interestRateValue');
        const durationSlider = document.getElementById('durationSlider');
        const durationValue = document.getElementById('durationValue');
        const compoundingFrequency = document.getElementById('compoundingFrequency');
        const savingsForm = document.getElementById('savingsForm');
        const resultsContainer = document.getElementById('resultsContainer');
        const futureValueElement = document.getElementById('futureValue');
        const totalContributionsElement = document.getElementById('totalContributions');
        const interestEarnedElement = document.getElementById('interestEarned');
        const monthlyIncomeElement = document.getElementById('monthlyIncome');
        const currencySelector = document.getElementById('currencySelector');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const refreshButton = document.getElementById('refreshButton');
        const savedPlansButton = document.getElementById('savedPlansButton');
        const downloadReportBtn = document.getElementById('downloadReportBtn');
        const saveCalculationBtn = document.getElementById('saveCalculationBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const increasingContributions = document.getElementById('increasingContributions');
        const lumpSumAmount = document.getElementById('lumpSumAmount');
        
        // Modal elements
        const savePlanModal = document.getElementById('savePlanModal');
        const savePlanCloseBtn = document.getElementById('savePlanCloseBtn');
        const planName = document.getElementById('planName');
        const planDetails = document.getElementById('planDetails');
        const cancelSavePlanBtn = document.getElementById('cancelSavePlanBtn');
        const confirmSavePlanBtn = document.getElementById('confirmSavePlanBtn');
        const savedPlansModal = document.getElementById('savedPlansModal');
        const savedPlansCloseBtn = document.getElementById('savedPlansCloseBtn');
        const savedPlansList = document.getElementById('savedPlansList');
        const closeSavedPlansBtn = document.getElementById('closeSavedPlansBtn');
        
        // Charts
        let savingsGrowthChart;
        let savingsBreakdownChart;
        let strategyComparisonChart;
        
        // Current calculation values
        let currentCalculation = {
            initialAmount: 10000,
            contributionAmount: 5000,
            contributionFrequency: 'monthly',
            interestRate: 5,
            duration: 10,
            compoundingFrequency: 'monthly',
            currency: 'KES'
        };
        
        // Current calculation results
        let currentResults = null;

        // Initialize the page
        function initializePage() {
            // Set up event listeners
            interestRateSlider.addEventListener('input', updateInterestRateValue);
            durationSlider.addEventListener('input', updateDurationValue);
            savingsForm.addEventListener('submit', calculateSavings);
            currencySelector.addEventListener('change', updateCurrency);
            darkModeToggle.addEventListener('change', toggleDarkMode);
            refreshButton.addEventListener('click', resetCalculator);
            savedPlansButton.addEventListener('click', showSavedPlans);
            downloadReportBtn.addEventListener('click', downloadReport);
            saveCalculationBtn.addEventListener('click', openSavePlanModal);
            
            // Modal event listeners
            savePlanCloseBtn.addEventListener('click', closeSavePlanModal);
            cancelSavePlanBtn.addEventListener('click', closeSavePlanModal);
            confirmSavePlanBtn.addEventListener('click', saveCalculationPlan);
            savedPlansCloseBtn.addEventListener('click', closeSavedPlansModal);
            closeSavedPlansBtn.addEventListener('click', closeSavedPlansModal);
            
            // Strategy comparison event listeners
            increasingContributions.addEventListener('change', updateStrategyComparison);
            lumpSumAmount.addEventListener('input', updateStrategyComparison);

            // Initialize values
            updateInterestRateValue();
            updateDurationValue();
            
            // Check for dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                darkModeToggle.checked = true;
                document.body.classList.add('dark-mode');
            }
            
            // Check for saved calculation
            const savedCalculation = localStorage.getItem('currentCalculation');
            if (savedCalculation) {
                currentCalculation = JSON.parse(savedCalculation);
                populateFormFromCurrentCalculation();
                calculateSavings({ preventDefault: () => {} }); // Simulate form submission
            }
        }

        // Update the interest rate value display
        function updateInterestRateValue() {
            interestRateValue.textContent = `${interestRateSlider.value}%`;
        }

        // Update the duration value display
        function updateDurationValue() {
            durationValue.textContent = `${durationSlider.value} years`;
        }

        // Calculate savings
        function calculateSavings(e) {
            e.preventDefault();
            
            // Get form values
            const initialAmount = parseFloat(initialAmountInput.value) || 0;
            const contributionAmount = parseFloat(contributionAmountInput.value) || 0;
            const contributionFrequency = document.querySelector('input[name="contributionFrequency"]:checked').value;
            const interestRate = parseFloat(interestRateSlider.value) || 0;
            const duration = parseInt(durationSlider.value) || 0;
            const compoundingFreq = compoundingFrequency.value;
            
            // Update current calculation
            currentCalculation = {
                initialAmount,
                contributionAmount,
                contributionFrequency,
                interestRate,
                duration,
                compoundingFrequency: compoundingFreq,
                currency: currencySelector.value
            };
            
            // Save current calculation to localStorage
            localStorage.setItem('currentCalculation', JSON.stringify(currentCalculation));
            
            // Calculate future value
            const result = calculateFutureValue(
                initialAmount,
                contributionAmount,
                contributionFrequency,
                interestRate,
                duration,
                compoundingFreq
            );
            
            // Store the results
            currentResults = result;
            
            // Display results
            displayResults(result);
            
            // Update strategy comparison
            updateStrategyComparison();
        }

        // Calculate future value based on inputs
        function calculateFutureValue(initialAmount, contributionAmount, contributionFrequency, interestRate, duration, compoundingFrequency) {
            // Convert interest rate to decimal
            const r = interestRate / 100;
            
            // Determine number of compounding periods per year
            let periodsPerYear;
            switch (compoundingFrequency) {
                case 'daily':
                    periodsPerYear = 365;
                    break;
                case 'monthly':
                    periodsPerYear = 12;
                    break;
                case 'quarterly':
                    periodsPerYear = 4;
                    break;
                case 'annually':
                    periodsPerYear = 1;
                    break;
                default:
                    periodsPerYear = 12;
            }
            
            // Calculate interest rate per period
            const ratePerPeriod = r / periodsPerYear;
            
            // Calculate total number of periods
            const totalPeriods = periodsPerYear * duration;
            
            // Calculate contributions per compounding period
            let contributionsPerPeriod;
            switch (contributionFrequency) {
                case 'monthly':
                    contributionsPerPeriod = contributionAmount * (12 / periodsPerYear);
                    break;
                case 'quarterly':
                    contributionsPerPeriod = contributionAmount * (4 / periodsPerYear);
                    break;
                case 'annually':
                    contributionsPerPeriod = contributionAmount * (1 / periodsPerYear);
                    break;
                default:
                    contributionsPerPeriod = contributionAmount;
            }
            
            // Calculate future value of initial amount
            const futureValueInitial = initialAmount * Math.pow(1 + ratePerPeriod, totalPeriods);
            
            // Calculate future value of periodic contributions
            const futureValueContributions = contributionsPerPeriod * ((Math.pow(1 + ratePerPeriod, totalPeriods) - 1) / ratePerPeriod);
            
            // Calculate total future value
            const futureValue = futureValueInitial + futureValueContributions;
            
            // Calculate total contributions
            const totalContributions = initialAmount + (contributionsPerPeriod * totalPeriods);
            
            // Calculate interest earned
            const interestEarned = futureValue - totalContributions;
            
            // Calculate estimated monthly income (4% withdrawal rule)
            const monthlyIncome = futureValue * 0.04 / 12;
            
            // Generate growth data for chart
            const growthData = generateGrowthData(
                initialAmount, 
                contributionsPerPeriod, 
                ratePerPeriod, 
                totalPeriods, 
                periodsPerYear
            );
            
            return {
                futureValue,
                totalContributions,
                interestEarned,
                monthlyIncome,
                growthData
            };
        }

        // Generate growth data for chart
        function generateGrowthData(initialAmount, contributionsPerPeriod, ratePerPeriod, totalPeriods, periodsPerYear) {
            const growthData = [];
            let balance = initialAmount;
            let totalContributions = initialAmount;
            
            for (let period = 0; period <= totalPeriods; period++) {
                // Only add contribution after first period
                if (period > 0) {
                    totalContributions += contributionsPerPeriod;
                    balance = balance * (1 + ratePerPeriod) + contributionsPerPeriod;
                }
                
                // Add data point every year (or at the end)
                if (period % periodsPerYear === 0 || period === totalPeriods) {
                    const year = period / periodsPerYear;
                    growthData.push({
                        year,
                        balance,
                        totalContributions,
                        interestEarned: balance - totalContributions
                    });
                }
            }
            
            return growthData;
        }

        // Display results
        function displayResults(result) {
            // Show results container
            resultsContainer.style.display = 'block';
            
            // Format numbers based on currency
            const formattedFutureValue = formatCurrency(result.futureValue);
            const formattedTotalContributions = formatCurrency(result.totalContributions);
            const formattedInterestEarned = formatCurrency(result.interestEarned);
            const formattedMonthlyIncome = formatCurrency(result.monthlyIncome);
            
            // Update elements
            futureValueElement.textContent = formattedFutureValue;
            totalContributionsElement.textContent = formattedTotalContributions;
            interestEarnedElement.textContent = formattedInterestEarned;
            monthlyIncomeElement.textContent = formattedMonthlyIncome;
            
            // Update charts
            updateSavingsGrowthChart(result.growthData);
            updateSavingsBreakdownChart(result.totalContributions, result.interestEarned);
        }

        // Format currency based on selected currency
        function formatCurrency(value) {
            const currencySymbol = getCurrencySymbol(currentCalculation.currency);
            return `${currencySymbol}${Math.round(value).toLocaleString()}`;
        }

        // Get currency symbol
        function getCurrencySymbol(currencyCode) {
            switch (currencyCode) {
                case 'USD':
                    return '$';
                case 'EUR':
                    return '€';
                case 'GBP':
                    return '£';
                case 'KES':
                default:
                    return 'KES ';
            }
        }

        // Update currency
        function updateCurrency() {
            currentCalculation.currency = currencySelector.value;
            
            // If results are visible, update them
            if (resultsContainer.style.display !== 'none') {
                const futureValue = parseFloat(futureValueElement.textContent.replace(/[^0-9.]/g, ''));
                const totalContributions = parseFloat(totalContributionsElement.textContent.replace(/[^0-9.]/g, ''));
                const interestEarned = parseFloat(interestEarnedElement.textContent.replace(/[^0-9.]/g, ''));
                const monthlyIncome = parseFloat(monthlyIncomeElement.textContent.replace(/[^0-9.]/g, ''));
                
                futureValueElement.textContent = formatCurrency(futureValue);
                totalContributionsElement.textContent = formatCurrency(totalContributions);
                interestEarnedElement.textContent = formatCurrency(interestEarned);
                monthlyIncomeElement.textContent = formatCurrency(monthlyIncome);
            }
        }

        // Update savings growth chart
        function updateSavingsGrowthChart(growthData) {
            const ctx = document.getElementById('savingsGrowthChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (savingsGrowthChart) {
                savingsGrowthChart.destroy();
            }
            
            // Prepare data for chart
            const labels = growthData.map(data => `Year ${data.year}`);
            const balanceData = growthData.map(data => data.balance);
            const contributionsData = growthData.map(data => data.totalContributions);
            
            // Create new chart
            savingsGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Balance',
                            data: balanceData,
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            borderColor: 'rgba(33, 150, 243, 1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Contributions',
                            data: contributionsData,
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderColor: 'rgba(76, 175, 80, 1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Savings Growth Over Time',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update savings breakdown chart
        function updateSavingsBreakdownChart(totalContributions, interestEarned) {
            const ctx = document.getElementById('savingsBreakdownChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (savingsBreakdownChart) {
                savingsBreakdownChart.destroy();
            }
            
            // Create new chart
            savingsBreakdownChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Principal', 'Interest'],
                    datasets: [{
                        data: [totalContributions, interestEarned],
                        backgroundColor: [
                            'rgba(33, 150, 243, 0.8)',
                            'rgba(76, 175, 80, 0.8)',
                        ],
                        borderColor: [
                            'rgba(33, 150, 243, 1)',
                            'rgba(76, 175, 80, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100) + '%';
                                    return `${label}: ${formatCurrency(value)} (${percentage})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update strategy comparison
        function updateStrategyComparison() {
            // Only proceed if we have calculated something
            if (resultsContainer.style.display === 'none') {
                return;
            }
            
            const {
                initialAmount,
                contributionAmount, 
                contributionFrequency,
                interestRate,
                duration,
                compoundingFrequency
            } = currentCalculation;
            
            // Strategy 1: Regular fixed contributions (current calculation)
            const strategy1 = calculateFutureValue(
                initialAmount,
                contributionAmount,
                contributionFrequency,
                interestRate,
                duration,
                compoundingFrequency
            );
            
            // Strategy 2: Increasing contributions
            const annualIncrease = parseInt(increasingContributions.value) / 100;
            const strategy2 = calculateIncreasingContributions(
                initialAmount,
                contributionAmount,
                contributionFrequency,
                interestRate,
                duration,
                compoundingFrequency,
                annualIncrease
            );
            
            // Strategy 3: Lump sum + smaller contributions
            const lumpSum = parseFloat(lumpSumAmount.value) || 0;
            const strategy3 = calculateFutureValue(
                initialAmount + lumpSum,
                contributionAmount * 0.5, // 50% smaller contributions
                contributionFrequency,
                interestRate,
                duration,
                compoundingFrequency
            );
            
            // Update comparison chart
            updateStrategyComparisonChart(strategy1, strategy2, strategy3);
            
            // Update comparison table
            updateStrategyComparisonTable(strategy1, strategy2, strategy3);
        }

        // Calculate future value with increasing contributions
        function calculateIncreasingContributions(initialAmount, startingContribution, contributionFrequency, interestRate, duration, compoundingFrequency, annualIncrease) {
            // Convert interest rate to decimal
            const r = interestRate / 100;
            
            // Determine number of compounding periods per year
            let periodsPerYear;
            switch (compoundingFrequency) {
                case 'daily':
                    periodsPerYear = 365;
                    break;
                case 'monthly':
                    periodsPerYear = 12;
                    break;
                case 'quarterly':
                    periodsPerYear = 4;
                    break;
                case 'annually':
                    periodsPerYear = 1;
                    break;
                default:
                    periodsPerYear = 12;
            }
            
            // Calculate interest rate per period
            const ratePerPeriod = r / periodsPerYear;
            
            // Calculate total number of periods
            const totalPeriods = periodsPerYear * duration;
            
            // Calculate contributions per compounding period based on frequency
            let contributionsPerPeriod;
            let contributionsPerYear;
            
            switch (contributionFrequency) {
                case 'monthly':
                    contributionsPerYear = 12;
                    break;
                case 'quarterly':
                    contributionsPerYear = 4;
                    break;
                case 'annually':
                    contributionsPerYear = 1;
                    break;
                default:
                    contributionsPerYear = 12;
            }
            
            // Generate growth data with increasing contributions
            const growthData = [];
            let balance = initialAmount;
            let totalContributions = initialAmount;
            let currentContribution = startingContribution;
            
            for (let year = 0; year <= duration; year++) {
                // First year uses initial values
                if (year > 0) {
                    // Increase contribution annually
                    currentContribution *= (1 + annualIncrease);
                }
                
                // Calculate contribution per period for this year
                contributionsPerPeriod = currentContribution * (contributionsPerYear / periodsPerYear);
                
                // Calculate periods for this year
                const periodsThisYear = (year === duration) ? 0 : periodsPerYear;
                
                // Simulate each period in the year
                for (let p = 0; p < periodsThisYear; p++) {
                    balance = balance * (1 + ratePerPeriod) + contributionsPerPeriod;
                    totalContributions += contributionsPerPeriod;
                }
                
                // Add data point for the year
                growthData.push({
                    year,
                    balance,
                    totalContributions,
                    interestEarned: balance - totalContributions
                });
            }
            
            return {
                futureValue: balance,
                totalContributions,
                interestEarned: balance - totalContributions,
                monthlyIncome: balance * 0.04 / 12,
                growthData
            };
        }

        // Update strategy comparison chart
        function updateStrategyComparisonChart(strategy1, strategy2, strategy3) {
            const ctx = document.getElementById('strategyComparisonChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (strategyComparisonChart) {
                strategyComparisonChart.destroy();
            }
            
            // Get labels (years) from strategy1
            const labels = strategy1.growthData.map(data => `Year ${data.year}`);
            
            // Prepare data for chart
            const strategy1Data = strategy1.growthData.map(data => data.balance);
            const strategy2Data = strategy2.growthData.map(data => data.balance);
            const strategy3Data = strategy3.growthData.map(data => data.balance);
            
            // Create new chart
            strategyComparisonChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Strategy 1: Fixed Contributions',
                            data: strategy1Data,
                            borderColor: 'rgba(33, 150, 243, 1)',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'Strategy 2: Increasing Contributions',
                            data: strategy2Data,
                            borderColor: 'rgba(76, 175, 80, 1)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'Strategy 3: Lump Sum + Smaller Contributions',
                            data: strategy3Data,
                            borderColor: 'rgba(255, 152, 0, 1)',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Savings Strategy Comparison',
                            font: {
                                size: 16
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatCurrency(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update strategy comparison table
        function updateStrategyComparisonTable(strategy1, strategy2, strategy3) {
            const tableBody = document.getElementById('strategyComparisonTable');
            tableBody.innerHTML = '';
            
            // Calculate efficiency ratios
            const efficiency1 = strategy1.interestEarned / strategy1.totalContributions;
            const efficiency2 = strategy2.interestEarned / strategy2.totalContributions;
            const efficiency3 = strategy3.interestEarned / strategy3.totalContributions;
            
            // Add rows for each strategy
            const strategies = [
                { name: 'Fixed Contributions', result: strategy1, efficiency: efficiency1 },
                { name: 'Increasing Contributions', result: strategy2, efficiency: efficiency2 },
                { name: 'Lump Sum + Smaller Contributions', result: strategy3, efficiency: efficiency3 }
            ];
            
            strategies.forEach((strategy, index) => {
                const row = document.createElement('tr');
                
                // Create cells
                const nameCell = document.createElement('td');
                nameCell.className = 'text-left padding-standard border-bottom';
                nameCell.innerHTML = `Strategy ${index + 1}: ${strategy.name}`;
                
                const finalAmountCell = document.createElement('td');
                finalAmountCell.className = 'text-right padding-standard border-bottom';
                finalAmountCell.textContent = formatCurrency(strategy.result.futureValue);
                
                const totalContributionCell = document.createElement('td');
                totalContributionCell.className = 'text-right padding-standard border-bottom';
                totalContributionCell.textContent = formatCurrency(strategy.result.totalContributions);
                
                const interestEarnedCell = document.createElement('td');
                interestEarnedCell.className = 'text-right padding-standard border-bottom';
                interestEarnedCell.textContent = formatCurrency(strategy.result.interestEarned);
                
                const efficiencyCell = document.createElement('td');
                efficiencyCell.className = 'text-right padding-standard border-bottom';
                efficiencyCell.textContent = strategy.efficiency.toFixed(2);
                
                // Append cells to row
                row.appendChild(nameCell);
                row.appendChild(finalAmountCell);
                row.appendChild(totalContributionCell);
                row.appendChild(interestEarnedCell);
                row.appendChild(efficiencyCell);
                
                // Append row to table
                tableBody.appendChild(row);
            });
        }

        // Toggle dark mode
        function toggleDarkMode() {
            if (darkModeToggle.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'disabled');
            }
            
            // Update charts if they exist
            if (savingsGrowthChart) {
                savingsGrowthChart.update();
            }
            if (savingsBreakdownChart) {
                savingsBreakdownChart.update();
            }
            if (strategyComparisonChart) {
                strategyComparisonChart.update();
            }
        }

        // Reset calculator
        function resetCalculator() {
            // Reset form to default values
            initialAmountInput.value = 10000;
            contributionAmountInput.value = 5000;
            document.querySelector('input[name="contributionFrequency"][value="monthly"]').checked = true;
            interestRateSlider.value = 5;
            durationSlider.value = 10;
            compoundingFrequency.value = 'monthly';
            
            // Update display values
            updateInterestRateValue();
            updateDurationValue();
            
            // Hide results
            resultsContainer.style.display = 'none';
            
            // Reset current calculation
            currentCalculation = {
                initialAmount: 10000,
                contributionAmount: 5000,
                contributionFrequency: 'monthly',
                interestRate: 5,
                duration: 10,
                compoundingFrequency: 'monthly',
                currency: currencySelector.value
            };
            
            // Reset current results
            currentResults = null;
            
            // Save to localStorage
            localStorage.setItem('currentCalculation', JSON.stringify(currentCalculation));
        }

        // Show saved plans modal
        function showSavedPlans() {
            // Load saved plans from localStorage
            loadSavedPlans();
            
            // Show modal
            savedPlansModal.classList.add('active');
        }

        // Close saved plans modal
        function closeSavedPlansModal() {
            savedPlansModal.classList.remove('active');
        }

        // Load saved plans from localStorage
        function loadSavedPlans() {
            // Get saved plans from localStorage
            const savedPlans = JSON.parse(localStorage.getItem('savedCalculationPlans')) || [];
            
            // Clear existing list
            savedPlansList.innerHTML = '';
            
            // If no saved plans, show message
            if (savedPlans.length === 0) {
                const noPlansMessage = document.createElement('div');
                noPlansMessage.className = 'no-saved-plans';
                noPlansMessage.textContent = 'You haven\'t saved any plans yet.';
                savedPlansList.appendChild(noPlansMessage);
                return;
            }
            
            // Add each saved plan to the list
            savedPlans.forEach((plan, index) => {
                const planItem = document.createElement('div');
                planItem.className = 'saved-plan-item';
                
                // Plan info
                const planInfo = document.createElement('div');
                planInfo.className = 'saved-plan-info';
                
                const planNameElem = document.createElement('div');
                planNameElem.className = 'saved-plan-name';
                planNameElem.textContent = plan.name;
                
                const planDateElem = document.createElement('div');
                planDateElem.className = 'saved-plan-date';
                planDateElem.textContent = new Date(plan.date).toLocaleDateString();
                
                planInfo.appendChild(planNameElem);
                planInfo.appendChild(planDateElem);
                
                // Plan actions
                const planActions = document.createElement('div');
                planActions.className = 'saved-plan-actions';
                
                const loadButton = document.createElement('button');
                loadButton.innerHTML = '<i class="fas fa-upload"></i>';
                loadButton.title = 'Load Plan';
                loadButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    loadSavedPlan(index);
                });
                
                const deleteButton = document.createElement('button');
                deleteButton.innerHTML = '<i class="fas fa-trash"></i>';
                deleteButton.title = 'Delete Plan';
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteSavedPlan(index);
                });
                
                planActions.appendChild(loadButton);
                planActions.appendChild(deleteButton);
                
                // Add to plan item
                planItem.appendChild(planInfo);
                planItem.appendChild(planActions);
                
                // Add click event to load plan
                planItem.addEventListener('click', () => {
                    loadSavedPlan(index);
                });
                
                // Add to list
                savedPlansList.appendChild(planItem);
            });
        }

        // Load saved plan
        function loadSavedPlan(index) {
            // Get saved plans from localStorage
            const savedPlans = JSON.parse(localStorage.getItem('savedCalculationPlans')) || [];
            
            // Get the selected plan
            const plan = savedPlans[index];
            
            // Update current calculation
            currentCalculation = plan.calculation;
            
            // Populate form from calculation
            populateFormFromCurrentCalculation();
            
            // Calculate savings with the loaded plan
            calculateSavings({ preventDefault: () => {} });
            
            // Close modal
            closeSavedPlansModal();
        }

        // Delete saved plan
        function deleteSavedPlan(index) {
            // Confirm deletion
            if (!confirm('Are you sure you want to delete this plan?')) {
                return;
            }
            
            // Get saved plans from localStorage
            const savedPlans = JSON.parse(localStorage.getItem('savedCalculationPlans')) || [];
            
            // Remove the selected plan
            savedPlans.splice(index, 1);
            
            // Save updated plans to localStorage
            localStorage.setItem('savedCalculationPlans', JSON.stringify(savedPlans));
            
            // Reload saved plans
            loadSavedPlans();
        }

        // Open save plan modal
        function openSavePlanModal() {
            // Only allow saving if a calculation has been performed
            if (!currentResults) {
                alert('Please calculate savings first before saving a plan.');
                return;
            }
            
            // Populate plan details
            updatePlanDetails();
            
            // Show modal
            savePlanModal.classList.add('active');
            
            // Focus on plan name input
            planName.focus();
        }

        // Close save plan modal
        function closeSavePlanModal() {
            savePlanModal.classList.remove('active');
        }

        // Update plan details in save plan modal
        function updatePlanDetails() {
            planDetails.innerHTML = '';
            
            // Get calculation details
            const { initialAmount, contributionAmount, contributionFrequency, interestRate, duration, compoundingFrequency, currency } = currentCalculation;
            
            // Create details list
            const detailsList = document.createElement('ul');
            detailsList.style.listStyle = 'none';
            detailsList.style.padding = '0';
            
            // Add details
            const details = [
                { label: 'Initial Amount', value: formatCurrency(initialAmount) },
                { label: 'Contribution', value: `${formatCurrency(contributionAmount)} (${contributionFrequency})` },
                { label: 'Interest Rate', value: `${interestRate}%` },
                { label: 'Duration', value: `${duration} years` },
                { label: 'Compounding', value: compoundingFrequency },
                { label: 'Future Value', value: formatCurrency(currentResults.futureValue) },
                { label: 'Interest Earned', value: formatCurrency(currentResults.interestEarned) }
            ];
            
            details.forEach(detail => {
                const item = document.createElement('li');
                item.style.marginBottom = '0.5rem';
                item.style.display = 'flex';
                item.style.justifyContent = 'space-between';
                
                const label = document.createElement('span');
                label.style.fontWeight = 'bold';
                label.textContent = detail.label + ':';
                
                const value = document.createElement('span');
                value.textContent = detail.value;
                
                item.appendChild(label);
                item.appendChild(value);
                
                detailsList.appendChild(item);
            });
            
            planDetails.appendChild(detailsList);
        }

        // Save calculation plan
        function saveCalculationPlan() {
            // Get plan name
            const name = planName.value.trim();
            
            // Validate plan name
            if (!name) {
                alert('Please enter a name for your plan.');
                planName.focus();
                return;
            }
            
            // Create plan object
            const plan = {
                name,
                date: new Date().toISOString(),
                calculation: currentCalculation,
                results: currentResults
            };
            
            // Get saved plans from localStorage
            const savedPlans = JSON.parse(localStorage.getItem('savedCalculationPlans')) || [];
            
            // Add new plan
            savedPlans.push(plan);
            
            // Save updated plans to localStorage
            localStorage.setItem('savedCalculationPlans', JSON.stringify(savedPlans));
            
            // Close modal
            closeSavePlanModal();
            
            // Show success message
            alert('Plan saved successfully!');
        }

        // Populate form from current calculation
        function populateFormFromCurrentCalculation() {
            initialAmountInput.value = currentCalculation.initialAmount;
            contributionAmountInput.value = currentCalculation.contributionAmount;
            document.querySelector(`input[name="contributionFrequency"][value="${currentCalculation.contributionFrequency}"]`).checked = true;
            interestRateSlider.value = currentCalculation.interestRate;
            durationSlider.value = currentCalculation.duration;
            compoundingFrequency.value = currentCalculation.compoundingFrequency;
            currencySelector.value = currentCalculation.currency;
            
            // Update display values
            updateInterestRateValue();
            updateDurationValue();
        }

        // Download report
        function downloadReport() {
            // Only allow downloading if a calculation has been performed
            if (!currentResults) {
                alert('Please calculate savings first before downloading a report.');
                return;
            }
            
            try {
                // Initialize jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('PesaGuru Savings Calculator Report', 105, 20, { align: 'center' });
                
                // Add date
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
                
                // Add calculation settings
                doc.setFontSize(14);
                doc.text('Calculation Settings', 20, 45);
                
                doc.setFontSize(10);
                const { initialAmount, contributionAmount, contributionFrequency, interestRate, duration, compoundingFrequency, currency } = currentCalculation;
                
                const settings = [
                    { label: 'Initial Amount', value: formatCurrency(initialAmount) },
                    { label: 'Regular Contribution', value: `${formatCurrency(contributionAmount)} (${contributionFrequency})` },
                    { label: 'Annual Interest Rate', value: `${interestRate}%` },
                    { label: 'Duration', value: `${duration} years` },
                    { label: 'Compounding Frequency', value: compoundingFrequency }
                ];
                
                let yPos = 55;
                settings.forEach(setting => {
                    doc.text(`${setting.label}: ${setting.value}`, 20, yPos);
                    yPos += 7;
                });
                
                // Add results
                doc.setFontSize(14);
                doc.text('Results', 20, yPos + 10);
                
                doc.setFontSize(10);
                const results = [
                    { label: 'Future Value', value: formatCurrency(currentResults.futureValue) },
                    { label: 'Total Contributions', value: formatCurrency(currentResults.totalContributions) },
                    { label: 'Interest Earned', value: formatCurrency(currentResults.interestEarned) },
                    { label: 'Monthly Income (4% rule)', value: formatCurrency(currentResults.monthlyIncome) }
                ];
                
                yPos += 20;
                results.forEach(result => {
                    doc.text(`${result.label}: ${result.value}`, 20, yPos);
                    yPos += 7;
                });
                
                // Add yearly breakdown
                doc.setFontSize(14);
                doc.text('Yearly Breakdown', 20, yPos + 10);
                
                // Table headers
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                yPos += 20;
                doc.text('Year', 20, yPos);
                doc.text('Balance', 60, yPos);
                doc.text('Contributions', 100, yPos);
                doc.text('Interest', 140, yPos);
                doc.setFont(undefined, 'normal');
                
                // Table rows
                yPos += 7;
                const maxRows = 10; // Limit to first 10 years for space
                const growth = currentResults.growthData.slice(0, maxRows + 1);
                
                growth.forEach((data, i) => {
                    doc.text(`${data.year}`, 20, yPos);
                    doc.text(`${formatCurrency(data.balance)}`, 60, yPos);
                    doc.text(`${formatCurrency(data.totalContributions)}`, 100, yPos);
                    doc.text(`${formatCurrency(data.interestEarned)}`, 140, yPos);
                    yPos += 7;
                    
                    // Add new page if needed
                    if (yPos > 280 && i < growth.length - 1) {
                        doc.addPage();
                        yPos = 20;
                        
                        // Add table headers to new page
                        doc.setFont(undefined, 'bold');
                        doc.text('Year', 20, yPos);
                        doc.text('Balance', 60, yPos);
                        doc.text('Contributions', 100, yPos);
                        doc.text('Interest', 140, yPos);
                        doc.setFont(undefined, 'normal');
                        yPos += 7;
                    }
                });
                
                // Add disclaimer
                doc.setFontSize(8);
                doc.text('Disclaimer: This is a simulation based on the provided assumptions. Actual results may vary.', 105, 280, { align: 'center' });
                
                // Save the PDF
                doc.save('pesaguru-savings-report.pdf');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('An error occurred while generating the PDF. Please try again later.');
            }
        }

        // Initialize the page when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>